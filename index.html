<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Иконка вкладки -->
    <link rel="icon" href="images/Team_Spirit_new_em.svg" type="image/svg+xml">
    <title>Team Spirit | DANO Solution</title>
    
    <!-- Подключаем CSS стиля Toxic -->
    <link rel="stylesheet" href="style-spirit.css">
    
    <!-- Подключаем библиотеку для графиков -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

</head>
<body>

    <!-- ВОДЯНОЙ ЗНАК -->
    <div class="watermark-container">
        <div class="watermark-text">TEAM SPIRIT</div>
        <!-- Логотип белый (инверсия) -->
        <img src="images/Team_Spirit_new_em.svg" alt="TS Logo" class="logo-watermark-img" style="filter: brightness(0) invert(1);">
    </div>

    <!-- СЧЕТЧИК СЛАЙДОВ -->
    <div class="slide-counter">
        <span id="currSlide" style="color: var(--accent);">01</span> / <span id="totalSlide">54</span>
    </div>

    <!-- ================= СЛАЙДЫ ================= -->

    <!-- 01. ТИТУЛЬНИК -->
    <div class="slide active flex-center">
        <div>
            <!-- Главный логотип -->
            <div style="display: flex; justify-content: center; align-items: center; gap: 30px; margin-bottom: 40px;">
                <img src="images/Team_Spirit_new_em.svg" alt="TS Logo" style="filter: brightness(0) invert(1); width: 180px; drop-shadow: 0 0 15px rgba(198, 255, 0, 0.2);">
                <span style="font-size: 3rem; font-weight: 900; color: var(--accent); text-shadow: 0 0 10px var(--accent);">X</span>
                <img src="images/X5_Tech.svg" alt="X5 Tech Logo" style="filter: brightness(0) invert(1); width: 300px; drop-shadow: 0 0 15px rgba(198, 255, 0, 0.2);">
            </div>
            
            <p style="letter-spacing: 4px; color: var(--accent); margin-bottom: 15px; font-weight: 700; text-shadow: 0 0 10px rgba(198, 255, 0, 0.4);">DANO OLYMPIAD 2025</p>
            <h1>Любовь одна а Data 2</h1>
            <div style="width: 80px; height: 6px; background: var(--accent); margin: 25px auto; box-shadow: 0 0 10px var(--accent);"></div>
            <p>Команда: Тим Спирит (филиал Таганрог)</p>
            <br>
            <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                <span class="tag">#DOTA_SCIENCE</span>
                <span class="tag">#ANALYTICS</span>
                <span class="tag">#TEAM_SPIRIT</span>
            </div>
        </div>
    </div>

    <!-- 02. СТРУКТУРА ДАТАСЕТА -->
    <div class="slide">
        <h2>02. Структура данных</h2>
        
        <!-- Убрали fill-height, добавили align-items: start -->
        <div style="display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 30px; align-items: start;">
            
            <!-- ЛЕВАЯ КОЛОНКА -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div class="card" style="display: flex; flex-direction: row; justify-content: space-between; align-items: center; border: 2px solid var(--accent); background: rgba(198, 255, 0, 0.05);">
                    <div>
                        <h3>Данные о магазинах</h3>
                        <p style="margin: 0; font-size: 1.2rem;">Торговой сети</p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card">
                        <div class="big-stat">256k</div>
                        <div class="stat-label">Строк данных</div>
                    </div>
                    <div class="card">
                        <div class="big-stat">21k</div>
                        <div class="stat-label">Магазина</div>
                    </div>
                </div>

                <div class="card" style="text-align: center;">
                    <h3>Период данных</h3>
                    <div class="big-stat" style="font-size: 3.5rem; margin: 10px 0;">2024</div>
                    <p>Информация по каждому месяцу</p>
                </div>
            </div>

            <!-- ПРАВАЯ КОЛОНКА -->
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div class="card">
                    <h3>Числовые признаки</h3>
                    <ul style="list-style: none; padding: 0; margin-top: 15px; font-size: 1.1rem;">
                        <li style="margin-bottom: 10px;">• Средний чек</li>
                        <li style="margin-bottom: 10px;">• Трафик</li>
                        <li style="margin-bottom: 10px;">• Инфраструктура</li>
                        <li>• Население</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Категориальные признаки</h3>
                    <ul style="list-style: none; padding: 0; margin-top: 15px; font-size: 1.1rem;">
                        <li style="margin-bottom: 10px;">• Площадь</li>
                        <li style="margin-bottom: 10px;">• Дата открытия</li>
                        <li style="margin-bottom: 10px;">• Населенный пункт</li>
                        <li>• Месяц (порядковая)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- 03. ОЧИСТКА ДАННЫХ -->
    <div class="slide">
        <h2>03. ОЧИСТКА ДАННЫХ</h2>
        <p>Борьба с выбросами и пропусками.</p>
        <div class="grid-2">
            <div class="card">
                <h3>ВЫБРОСЫ</h3>
                <p class="big-stat" style="color: #ff5555;">5%</p>
                <p>Удалено по правилу 3-х сигм</p>
            </div>
            <div class="card">
                <h3>ПРОПУСКИ</h3>
                <p class="big-stat">2%</p>
                <p>Заполнены медианой по региону</p>
            </div>
        </div>
        <div style="margin-top: 30px; padding: 20px; border: 1px dashed #555;">
            <h3>МЕТОДЫ</h3>
            <ul style="list-style: none; padding: 0; display: flex; gap: 20px; justify-content: center;">
                <li class="tag">IQR Filtering</li>
                <li class="tag">Median Imputation</li>
                <li class="tag">Log Transformation</li>
            </ul>
        </div>
    </div>

    <!-- 04. НОВЫЕ ПЕРЕМЕННЫЕ: ОКРУЖЕНИЕ -->
    <div class="slide">
        <h2>04. НОВЫЕ ПЕРЕМЕННЫЕ: ОКРУЖЕНИЕ</h2>
        
        <!-- Сделали левую колонку чуть шире, чтобы вместить 6 категорий -->
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; align-items: start;">
            
            <!-- Левая колонка: Население (Обновленная группировка) -->
            <div class="card" style="padding: 20px;">
                <h3 style="color: var(--accent); margin-bottom: 20px; font-size: 1.5rem;">КЛАССИФИКАЦИЯ ГОРОДОВ (POPULATION)</h3>
                
                <!-- Сетка 3x2 для 6 категорий -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
                    <!-- 1 -->
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; border: 1px solid #333;">
                        <div style="color: var(--accent); font-weight: bold; font-size: 0.9rem;">МАЛЫЙ</div>
                        <div style="font-size: 0.75rem; color: #888;">0-50 тыс.</div>
                    </div>
                    <!-- 2 -->
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; border: 1px solid #333;">
                        <div style="color: #fff; font-weight: bold; font-size: 0.9rem;">СРЕДНИЙ</div>
                        <div style="font-size: 0.75rem; color: #888;">50-100 тыс.</div>
                    </div>
                    <!-- 3 -->
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; border: 1px solid #333;">
                        <div style="color: #fff; font-weight: bold; font-size: 0.9rem;">БОЛЬШОЙ</div>
                        <div style="font-size: 0.75rem; color: #888;">100-250 тыс.</div>
                    </div>
                    <!-- 4 -->
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; border: 1px solid #333;">
                        <div style="color: #fff; font-weight: bold; font-size: 0.9rem;">КРУПНЫЙ</div>
                        <div style="font-size: 0.75rem; color: #888;">250-500 тыс.</div>
                    </div>
                    <!-- 5 -->
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; border: 1px solid #333;">
                        <div style="color: #fff; font-weight: bold; font-size: 0.8rem;">КРУПНЕЙШИЙ</div> <!-- Чуть меньше шрифт, чтобы влезло -->
                        <div style="font-size: 0.75rem; color: #888;">500 тыс. - 1 млн</div>
                    </div>
                    <!-- 6 -->
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; border: 1px solid #333;">
                        <div style="color: var(--accent); font-weight: bold; font-size: 0.8rem;">МИЛЛИОННИК</div>
                        <div style="font-size: 0.75rem; color: #888;">> 1 млн</div>
                    </div>
                </div>

                <!-- Сноска -->
                <div style="border-top: 1px solid #333; padding-top: 10px; font-size: 0.75rem; color: #666; font-style: italic;">
                    * Для корректного сравнения эффективности использована градостроительная классификация из учебника Т.В. Малеевой «Инженерно-экономические основы градостроительства».
                </div>
            </div>

            <!-- Правая колонка: Конкуренты -->
            <div class="card" style="padding: 20px; border: 1px dashed #555;">
                <h3 style="color: var(--accent);">Наличие пятерочёк</h3>
                <div class="big-stat" style="font-size: 2.5rem; margin: 15px 0;">БИНАРНЫЙ</div>
                <p style="font-size: 0.9rem;">
                    Флаг: <strong>Есть конкурент рядом / Нет</strong>.
                </p>
                <br>
                <p style="font-size: 0.85rem; color: #aaa;">
                    Для проверки гипотезы важнее сам факт наличия магазина сети поблизости, а не их точное количество.
                </p>
            </div>
        </div>
    </div>

    <!-- 05. НОВЫЕ ПЕРЕМЕННЫЕ: МЕТРИКИ -->
    <div class="slide" id="slide-metrics">
        <h2>05. ПРЕОБРАЗОВАНИЕ МЕТРИК</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: auto 1fr; gap: 20px; height: 65vh;">
            
            <!-- 1. Выручка (Левая колонка, Верх) -->
            <div class="card" style="display: flex; flex-direction: column; justify-content: center; align-items: flex-start; padding: 20px;">
                <h3 style="margin-bottom: 5px;">НОВАЯ ЦЕЛЕВАЯ: ВЫРУЧКА</h3>
                <p style="font-size: 0.8rem; margin-bottom: 10px; color: #aaa;">
                    Средний чек и трафик по отдельности не отражают результат.
                </p>
                <div class="code-block" style="margin: 0; padding: 8px 12px; font-size: 0.8rem; display: inline-block; white-space: nowrap;">
                    Выручка = Средний_чек * Трафик
                </div>

                <!-- НОВАЯ ПОДПИСЬ -->
                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #333; width: 100%;">
                    <p style="font-size: 0.7rem; color: #666; font-style: italic; margin: 0;">
                        * Переменные модифицированы составителями датасета
                    </p>
                </div>
            </div>

            <!-- 2. График (Правая колонка, На всю высоту) -->
            <div class="card" style="grid-column: 2; grid-row: 1 / -1; padding: 15px; overflow: hidden; display: flex; flex-direction: column;">
                <h3 style="text-align: center; color: var(--accent); margin-bottom: 10px;">РАСПРЕДЕЛЕНИЕ ВЫРУЧКИ</h3>
                <div style="flex: 1; display: flex; overflow: hidden;">
                    <div style="writing-mode: vertical-rl; transform: rotate(180deg); text-align: center; color: #888; font-size: 0.8rem; padding: 5px 0; margin-right: 5px;">
                        Количество магазинов
                    </div>
                    <div class="chart-container-fix" style="flex: 1;">
                        <div id="chart-mini-revenue" style="width: 100%; height: 100%;"></div>
                    </div>
                </div>
            </div>

            <!-- 3. Новый магазин + Статистика (Левая колонка, Низ) -->
            <div class="card" style="display: flex; flex-direction: column; justify-content: space-between; padding: 20px;">
                <div>
                    <h3 style="color: var(--accent); margin-bottom: 10px;">НОВЫЙ МАГАЗИН</h3>
                    <ul style="font-size: 0.85rem; list-style: none; padding-left: 0; margin-bottom: 15px; color: #e0e0e0;">
                        <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                            <span style="color: var(--accent); margin-right: 10px; font-weight: bold;">&bull;</span>
                            <span>Неполная история за год</span>
                        </li>
                        <li style="margin-bottom: 5px; display: flex; align-items: flex-start;">
                            <span style="color: var(--accent); margin-right: 10px; font-weight: bold;">&bull;</span>
                            <span>Сильная разница в выручке в соседние месяцы</span>
                        </li>
                    </ul>
                </div>

                <!-- СЕТКА 2x2 С ЦИФРАМИ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: auto;">
                    
                    <!-- Ячейка 1: Новый -->
                    <div style="background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 6px; border: 1px solid #333;">
                        <div style="font-size: 0.7rem; color: var(--accent); text-transform: uppercase; font-weight: 700; margin-bottom: 2px;">Новый</div>
                        <div style="font-size: 1.1rem; font-weight: 900; color: #fff;">1 072</div>
                    </div>

                    <!-- Ячейка 2: Недавно открытые -->
                    <div style="background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 6px; border: 1px solid #333;">
                        <div style="font-size: 0.7rem; color: #888; text-transform: uppercase; font-weight: 700; margin-bottom: 2px;">Недавно открытые</div>
                        <div style="font-size: 1.1rem; font-weight: 900; color: #fff;">6 326</div>
                    </div>

                    <!-- Ячейка 3: Средний возраст -->
                    <div style="background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 6px; border: 1px solid #333;">
                        <div style="font-size: 0.7rem; color: #888; text-transform: uppercase; font-weight: 700; margin-bottom: 2px;">Средний возраст</div>
                        <div style="font-size: 1.1rem; font-weight: 900; color: #fff;">13 428</div>
                    </div>

                    <!-- Ячейка 4: Открыты давно -->
                    <div style="background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 6px; border: 1px solid #333;">
                        <div style="font-size: 0.7rem; color: #888; text-transform: uppercase; font-weight: 700; margin-bottom: 2px;">Открыты давно</div>
                        <div style="font-size: 1.1rem; font-weight: 900; color: #fff;">916</div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- 06. ИССЛЕДОВАТЕЛЬСКИЙ ВОПРОС -->
    <div class="slide">
        <h2>06. ИССЛЕДОВАТЕЛЬСКИЙ ВОПРОС</h2>
        <div class="card flex-center" style="flex: 1; height: auto;">
            <h1 style="font-size: 2.5rem; text-align: center;">
                как <span style="color: var(--accent);">инфраструктура</span> влияет на <span style="color: var(--accent);">выручку</span> пятерочки ?
            </h1>
        </div>
    </div>

    <!-- 07. АНАЛИЗ ВЫРУЧКИ И ЧЕКА -->
    <div class="slide" id="chartSlide1">
        <h2>07. АНАЛИЗ ВЫРУЧКИ И ЧЕКА</h2>
        
        <!-- Используем grid с фиксированной высотой (например 65vh), чтобы графики были большие -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 65vh; width: 100%;">
            
            <!-- Добавляем overflow: hidden в style -->
            <div class="card" style="padding: 15px; height: 100%; overflow: hidden;">
                <h3 style="text-align: center; color: var(--accent);">РАСПРЕДЕЛЕНИЕ ВЫРУЧКИ</h3>
                <!-- Обертка fix -->
                <div class="chart-container-fix">
                    <div id="chart-bar-settlements" style="width: 100%; height: 100%;"></div>
                </div>
            </div>

            <div class="card" style="padding: 15px; height: 100%; overflow: hidden;">
                <h3 style="text-align: center; color: var(--accent);">СРЕДНИЙ ЧЕК</h3>
                <!-- Обертка fix -->
                <div class="chart-container-fix">
                    <div id="chart-avg-check" style="width: 100%; height: 100%;"></div>
                </div>
            </div>

        </div>
    </div>
        

    <!-- 08. ГРАФИКИ (КОРРЕЛЯЦИИ) -->
    <div class="slide" id="chartSlide2">
        <h2>08. КОРРЕЛЯЦИИ</h2>
        <div class="card" style="height: 70vh; padding: 10px; overflow: hidden;">
            <div class="chart-container-fix">
                 <div id="chart-heatmap" style="width: 100%; height: 100%;"></div>
            </div>
        </div>
    </div>

    <!-- 09. ГИПОТЕЗА -->
    <div class="slide">
        <h2>09. ГИПОТЕЗА</h2>
        <div class="fill-height flex-center">
            <div class="card" style="padding: 50px; border: 2px solid var(--accent); text-align: center; max-width: 900px; background: rgba(198, 255, 0, 0.02);">
               <h1 style="font-size: 2.5rem; line-height: 1.4; text-transform: none; text-shadow: none;">
                   Рядом стоящие пятёрочки <span style="color: var(--accent);">значительнее</span> снижают <span style="color: var(--accent);">выручку</span> старого магазина, чем <span style="color: var(--accent);">выручку</span> остальных
               </h1>
            </div>
        </div>
    </div>

    <!-- 10. ОСНОВНОЙ МЕХАНИЗМ -->
    <div class="slide">
        <h2>10. МЕХАНИЗМ: ДИЗАЙН</h2>
        
        <div class="fill-height" style="display: flex; flex-direction: column; justify-content: center; gap: 15px;">
            
            <!-- 1. ИСТОК -->
            <div class="card flex-center" style="padding: 20px; border-color: var(--accent);">
                <h3 style="color: var(--accent); margin: 0; font-size: 1.3rem;">СОВРЕМЕННОЕ ОБОРУДОВАНИЕ И ДИЗАЙН</h3>
            </div>

            <!-- Стрелка -->
            <div style="text-align: center; color: var(--accent); font-size: 1.5rem; line-height: 1;">▼</div>

            <!-- 2. СЛЕДСТВИЕ -->
            <div class="card flex-center" style="padding: 15px; border: 1px dashed #555;">
                <p style="margin: 0; font-weight: bold; font-size: 1.1rem;">НОВЫЕ ПЯТЕРОЧКИ ПРИВЛЕКАТЕЛЬНЕЕ СТАРЫХ</p>
            </div>

            <!-- Стрелка -->
            <div style="text-align: center; color: var(--accent); font-size: 1.5rem; line-height: 1;">▼</div>

            <!-- 3. РАЗВЕТВЛЕНИЕ (2 ПУНКТА) -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; width: 100%;">
                
                <!-- Пункт 1 -->
                <div class="card" style="padding: 20px; background: rgba(198, 255, 0, 0.05);">
                    <div style="display: flex; align-items: baseline; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 2.5rem; font-weight: 900; color: var(--accent); line-height: 1;">01</span>
                        <h4 style="margin: 0;">НОВЫЕ</h4>
                    </div>
                    <p style="font-size: 0.95rem;">
                        Теряют <span style="color: var(--accent); font-weight: 900; text-transform: uppercase;">меньше</span> спроса от наличия старых магазинов рядом.
                    </p>
                </div>

                <!-- Пункт 2 -->
                <div class="card" style="padding: 20px; background: rgba(255, 85, 85, 0.05); border-color: #ff5555;">
                    <div style="display: flex; align-items: baseline; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 2.5rem; font-weight: 900; color: #ff5555; line-height: 1;">02</span>
                        <h4 style="margin: 0;">СТАРЫЕ</h4>
                    </div>
                    <p style="font-size: 0.95rem;">
                        Теряют <span style="color: #ff5555; font-weight: 900; text-transform: uppercase;">больше</span> спроса от наличия новых магазинов рядом.
                    </p>
                </div>
            </div>

            <!-- Стрелка -->
            <div style="text-align: center; color: var(--accent); font-size: 1.5rem; line-height: 1;">▼</div>

            <!-- 4. ФИНАЛЬНЫЙ ВЫВОД -->
            <div class="card" style="padding: 20px; text-align: center; border: 2px solid var(--accent); background: rgba(198, 255, 0, 0.02);">
                <p style="font-size: 1.2rem; line-height: 1.4; font-weight: bold; margin: 0;">
                    Наличие пятерочёк рядом <span style="color: var(--accent);">значительнее</span> влияет на выручку <span style="color: #ff5555;">СТАРЫХ</span>, чем на выручку новых.
                </p>
            </div>

        </div>
    </div>

    <!-- 11. АЛЬТЕРНАТИВНЫЙ МЕХАНИЗМ -->
    <div class="slide">
        <h2>11. АЛЬТЕРНАТИВНЫЙ МЕХАНИЗМ</h2>
        
        <div class="fill-height" style="display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px;">
            
            <!-- БЛОК ЦЕПОЧКИ -->
            <div style="display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 800px;">
                
                <!-- Шаг 1 -->
                <div class="card" style="display: flex; flex-direction: row; align-items: center; gap: 20px; padding: 25px;">
                    <div style="background: #333; color: #fff; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                    <div>
                        <h3 style="color: var(--accent); margin-bottom: 5px;">Неполнота информации</h3>
                        <h5>Старые пятерочки открывались без информации о местности в момент сбора данных для датасета.</h5>
                    </div>
                </div>

                <!-- Стрелка -->
                <div style="text-align: center; color: #555; font-size: 1.5rem; line-height: 0.5;">▼</div>

                <!-- Шаг 2 -->
                <div class="card" style="display: flex; flex-direction: row; align-items: center; gap: 20px; padding: 25px;">
                    <div style="background: #333; color: #fff; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                    <div>
                        <h3 style="color: #fff; margin-bottom: 5px;">ОПТИМАЛЬНАЯ ЛОКАЦИЯ</h3>
                        <p>Новые пятёрочки <span style="color: var(--accent);">оптимальнее</span> старых выбрали место для открытия с учетом окружения.</p>
                    </div>
                </div>

                <!-- Стрелка -->
                <div style="text-align: center; color: #555; font-size: 1.5rem; line-height: 0.5;">▼</div>

                <!-- Шаг 3 (Вывод) -->
                <div class="card" style="border-left: 6px solid var(--accent); padding: 25px; background: rgba(255, 255, 255, 0.02);">
                    <h3 style="margin-bottom: 5px;">СЛЕДСТВИЕ</h3>
                    <p style="font-size: 1.1rem;">
                        Выручка новых пятёрочек будет <span style="color: var(--accent); font-weight: bold;">слабее зависеть</span> от наличия пятёрочек рядом.
                    </p>
                </div>
            </div>

            <!-- СНОСКА (FOOTNOTE) -->
            <div style="margin-top: 40px; text-align: center; opacity: 0.6;">
                <p style="font-size: 0.8rem; color: #888; font-style: italic;">
                    * Идея модели Хотеллинга, но с последующим изменением спроса в каждой точке и с последовательным открытием магазинов.
                </p>
            </div>

        </div>
    </div>

    <!-- 11. МАТ МОДЕЛЬ -->
    <div class="slide" id="chartSlide3">
        <h2>11. МАТ МОДЕЛЬ</h2>
        <div class="grid-2">
            <div>
                <p>CatBoost Regressor</p>
                <div class="code-block">
model = CatBoostRegressor(
    iterations=1000,
    learning_rate=0.05,
    loss_function='RMSE'
)
model.fit(X_train, y_train)
                </div>
            </div>
            <div class="card" style="padding: 10px;">
                <div id="chart-model-perf" style="width: 100%; height: 100%;"></div>
            </div>
        </div>
    </div>

    <!-- 12. УСТОЙЧИВОСТЬ -->
    <div class="slide" id="chartSlide4">
        <h2>12. УСТОЙЧИВОСТЬ</h2>
        <p>Проверка на различных подвыборках.</p>
        <div class="card" style="height: 60%; padding: 10px; margin-top: 20px;">
             <div id="chart-robustness" style="width: 100%; height: 100%;"></div>
        </div>
    </div>

    <!-- 13. ИНТЕРПРЕТАЦИЯ -->
    <div class="slide">
        <h2>13. ИНТЕРПРЕТАЦИЯ</h2>
        <div class="grid-3">
            <div class="card">
                <span class="stat-label">R2 SCORE</span>
                <span class="big-stat">0.85</span>
            </div>
            <div class="card">
                <span class="stat-label">MAE</span>
                <span class="big-stat">15k</span>
            </div>
            <div class="card">
                <span class="stat-label">MAPE</span>
                <span class="big-stat" style="color: var(--accent);">4.2%</span>
            </div>
        </div>
        <p style="margin-top: 30px;">Модель отлично предсказывает выручку новых магазинов.</p>
    </div>

    <!-- 14. ОГРАНИЧЕНИЯ И ПЕРСПЕКТИВЫ -->
    <div class="slide">
        <h2>14. ОГРАНИЧЕНИЯ И ПЕРСПЕКТИВЫ</h2>
        <div class="grid-2">
            <div class="card">
                <h3>ОГРАНИЧЕНИЯ</h3>
                <ul>
                    <li>Нет данных о погоде</li>
                    <li>Не учитываются акции конкурентов</li>
                </ul>
            </div>
            <div class="card">
                <h3>ПЕРСПЕКТИВЫ</h3>
                <ul>
                    <li>Добавить гео-данные</li>
                    <li>Использовать нейросети для временных рядов</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 15. ПОЛИСИ -->
    <div class="slide">
        <h2>15. ПОЛИСИ</h2>
        <div class="grid-2">
            <div class="card">
                <h3>БИЗНЕС-РЕШЕНИЕ</h3>
                <p>Корректировать план открытий в малых городах с учетом плотности конкурентов.</p>
            </div>
            <div class="card" style="border: 1px solid var(--accent);">
                <h3>ЭФФЕКТ</h3>
                <p class="big-stat" style="color: var(--accent);">+$50M</p>
                <p>Potential Revenue Uplift</p>
            </div>
        </div>
    </div>

    <!-- 16. КОМАНДА -->
    <div class="slide">
        <h2>16. КОМАНДА</h2>
        <div class="fill-height" style="justify-content: center;">
            <div style="display: flex; justify-content: center; gap: 20px; width: 100%; height: 60%;"> <!-- Ограничиваем высоту контейнера фото -->
                <div class="card" style="padding: 10px; flex: 1;">
                    <div class="team-photo-box" style="height: 70%; background-image: url('images/photo_2025-12-09_11-27-21.jpg');"></div>
                    <div style="padding: 10px;"><h3>CARRY</h3></div>
                </div>
                <div class="card" style="padding: 10px; flex: 1;">
                    <div class="team-photo-box" style="height: 70%; background-image: url('images/db112ad479a169c8f5f1465418636ee5.1000x1000x1.png');"></div>
                    <div style="padding: 10px;"><h3>MID</h3></div>
                </div>
                <div class="card" style="padding: 10px; flex: 1;">
                    <div id="offlane-photo" class="team-photo-box dead" style="height: 70%; background-image: url('images/penis.jpg');"></div>
                    <div style="padding: 10px;"><h3>OFFLANE</h3></div>
                    <h5>вечная память</h5>
                </div>
                 <div class="card" style="padding: 10px; flex: 1;">
                    <div class="team-photo-box" style="height: 70%; background-image: url('images/tete.jpg');"></div>
                    <div style="padding: 10px;"><h3>SUPPORT</h3></div>
                </div>
                <div class="card" style="padding: 10px; flex: 1;">
                    <div class="team-photo-box" style="height: 70%; background-image: url('images/photo_2025-12-09_11-27-57.jpg');"></div>
                    <div style="padding: 10px;"><h3>HARD SUPPORT</h3></div>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- ФИНАЛ -->
    <div class="slide flex-center">
        <img src="images/pudge.png" style="position: absolute; top: 0; left: 30%; width: 70%; height: 100%; object-fit: cover; opacity: 0.25; z-index: 0; pointer-events: none;" alt="Pudge">
        <div style="position: relative; z-index: 1;">
            <h1 style="font-size: 4.5rem;">GG WP</h1>
            <p style="color: var(--accent);">THANKS FOR WATCHING</p>
            <div style="margin-top: 40px;">
                <img src="images/Team_Spirit_new_em.svg" alt="TS Logo" style="filter: brightness(0) invert(1); width: 150px; opacity: 0.6;">
            </div>
        </div>
    </div>



    <div id="resurrection-explosion"></div>
    <!-- ================= CONTROLS & JS ================= -->
    <div class="controls">
        <div class="btn-group">
            <button class="btn" onclick="prevSlide()"> &#8249; </button>
            <button class="btn" onclick="nextSlide()"> &#8250; </button>
        </div>
    </div>

    <script>
    // ==========================================
    // ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ДЛЯ ГРАФИКОВ
    // ==========================================
    let chartSettlements, chartHeatmap, chartModel, chartRobustness;
    let chartAvgCheck;
    let chartMiniRevenue;

    const ACCENT_COLOR = '#C6FF00'; 
    const TEXT_COLOR = '#ffffff';

    // Общие настройки графиков
    const commonOptions = {
        chart: {
            background: 'transparent',
            toolbar: { show: false },
            animations: { enabled: true, easing: 'easeinout', speed: 800 },
            fontFamily: 'Inter, sans-serif',
        },
        theme: { mode: 'dark' },
        colors: [ACCENT_COLOR, '#444444'],
        grid: { borderColor: '#333', strokeDashArray: 4 },
        dataLabels: { enabled: false },
        stroke: { curve: 'smooth', width: 3 },
    };
    const optionsAvgCheck = {
        ...commonOptions,
        series: [{
            name: 'Средний чек',
            data: [1319, 969, 937, 776]
        }],
        chart: { 
            type: 'bar', 
            height: '100%', 
            background: 'transparent', 
            toolbar: { show: false }, 
            animations: { enabled: true } 
        },
        grid: {
            padding: { bottom: 10, left: 10, right: 20 }
        },
        plotOptions: { 
            bar: { 
                borderRadius: 4, 
                horizontal: true, 
                barHeight: '60%',
                distributed: true 
            } 
        },
        colors: [ACCENT_COLOR, '#aeea00', '#96d000', '#7cb300'],
        xaxis: { 
            categories: ['Открыт давно', 'Средний возраст', 'Недавно открытый', 'Новый'], 
            labels: { 
                style: { colors: '#888', fontSize: '12px' },
            },
            axisBorder: { show: false },
            axisTicks: { show: false }
        },
        yaxis: {
            labels: { 
                style: { colors: '#ffffff', fontSize: '14px', fontWeight: 'bold' },
                maxWidth: 200
            }
        },
        tooltip: { theme: 'dark', y: { formatter: (val) => val + " ₽" } },
        legend: { show: false }
    };

    // ==========================================
    // ФУНКЦИЯ ДЛЯ ГИСТОГРАММЫ (БИННИНГ)
    // ==========================================
    function createHistogramData(dataArray) {
        // 1. Чистим данные
        const nums = dataArray.map(v => parseFloat(v)).filter(v => !isNaN(v));
        if (nums.length === 0) return { categories: [], data: [] };

        const minVal = Math.min(...nums);
        const maxVal = Math.max(...nums);

        // 2. Задаем шаг: 5 * 10^7 = 50,000,000
        const step = 3000000; 

        // 3. Выравниваем начало и конец по сетке шага
        // Например, если минимум 12M, начало оси будет 0. Если 60M -> 50M.
        const start = Math.floor(minVal / step) * step;
        const end = Math.ceil(maxVal / step) * step;

        // 4. Генерируем категории (подписи)
        const categories = [];
        const binsCount = Math.round((end - start) / step) + 1; // +1 на всякий случай для запаса
        const bins = new Array(binsCount).fill(0);

        for (let i = 0; i < binsCount; i++) {
            const currentVal = start + (i * step);
            // Красивое форматирование: 50M, 100M
            const label = new Intl.NumberFormat('en-US', { 
                notation: "compact", 
                compactDisplay: "short",
                maximumFractionDigits: 1 
            }).format(currentVal);
            
            categories.push(label);
        }

        // 5. Раскладываем данные по корзинам
        nums.forEach(num => {
            // Находим индекс корзины относительно start
            let bucketIndex = Math.floor((num - start) / step);
            
            if (bucketIndex < 0) bucketIndex = 0;
            if (bucketIndex >= binsCount) bucketIndex = binsCount - 1;
            
            bins[bucketIndex]++;
        });

        // Удаляем пустые хвосты справа, если нужно (опционально), но оставим для сетки
        return { categories, data: bins };
    }

    // ==========================================
    // НАСТРОЙКИ ОСНОВНЫХ ГРАФИКОВ
    // ==========================================

    // СЛАЙД 7: ГИСТОГРАММА (Заготовка)
    const optionsBarSettlements = {
        ...commonOptions,
        series: [{ name: 'Магазинов', data: [] }],
        chart: { type: 'bar', height: '100%', background: 'transparent', toolbar: { show: false }, animations: { enabled: true } },
        plotOptions: { 
            bar: { borderRadius: 0, horizontal: false, columnWidth: '100%' } 
        },
        // Увеличили отступ снизу до 30
        grid: {
            borderColor: '#333',
            strokeDashArray: 4,
            padding: { bottom: 30, left: 10, right: 10 }
        },
        xaxis: { 
            categories: [], 
            title: {
                text: 'Выручка',
                offsetY: -5,
                // УВЕЛИЧИЛ ШРИФТ
                style: { color: '#ffffff', fontSize: '16px', fontWeight: 'bold' }
            },
            labels: { 
                show: true,
                rotate: -45,
                // УВЕЛИЧИЛ ШРИФТ ЦИФР СНИЗУ
                style: { colors: '#888', fontSize: '12px' },
                formatter: function(val, timestamp, opts) {
                    if (opts && typeof opts.i !== 'undefined') {
                        if (opts.i % 8 === 0) return val; 
                        return ''; 
                    }
                    return val;
                }
            }, 
            axisBorder: { show: false }, 
            axisTicks: { show: false } 
        },
        yaxis: {
            min: 0,
            title: {
                text: 'Количество',
                // УВЕЛИЧИЛ ШРИФТ
                style: { color: '#ffffff', fontSize: '16px', fontWeight: 'bold' }
            },
            // УВЕЛИЧИЛ ШРИФТ ЦИФР СЛЕВА
            labels: { style: { colors: '#888', fontSize: '13px' } }
        },
        colors: [ACCENT_COLOR],
        tooltip: { theme: 'dark', y: { formatter: (val) => val + " шт." } }
    };

    // СЛАЙД 8: HEATMAP
    const optionsHeatmap = {
        ...commonOptions,
        series: [
            { name: 'Revenue', data: [1.0, 0.8, 0.1, 0.4] },
            { name: 'Competitors', data: [0.8, 1.0, 0.3, 0.2] },
            { name: 'Population', data: [0.1, 0.3, 1.0, 0.5] },
            { name: 'Is_New', data: [0.4, 0.2, 0.5, 1.0] }
        ],
        chart: { type: 'heatmap', height: '100%', background: 'transparent', toolbar: { show: false } },
        plotOptions: { heatmap: { shadeIntensity: 0.5, colorScale: { ranges: [{ from: 0, to: 0.5, color: '#333333' }, { from: 0.51, to: 1.0, color: ACCENT_COLOR }] } } },
        xaxis: { categories: ['Rev', 'Comp', 'Pop', 'New'] }
    };

    // СЛАЙД 10: МОДЕЛЬ
    const optionsModelPerf = {
        ...commonOptions,
        series: [{ name: 'Actual', data: [30, 40, 35, 50, 49, 60, 70] }, { name: 'Predicted', data: [32, 38, 36, 52, 48, 62, 68] }],
        chart: { type: 'area', height: '100%', background: 'transparent', toolbar: { show: false } },
        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.05, stops: [0, 90, 100] } },
        xaxis: { categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'], axisBorder: { show: false }, axisTicks: { show: false } },
        colors: ['#ffffff', ACCENT_COLOR]
    };

    // СЛАЙД 11: УСТОЙЧИВОСТЬ
    const optionsRobustness = {
        ...commonOptions,
        series: [{ name: 'Train', data: [0.85, 0.84, 0.86] }, { name: 'Test', data: [0.83, 0.82, 0.84] }, { name: 'OOT', data: [0.81, 0.80, 0.82] }],
        chart: { type: 'bar', height: '100%', background: 'transparent', toolbar: { show: false } },
        plotOptions: { bar: { borderRadius: 2, horizontal: false, columnWidth: '50%' } },
        xaxis: { categories: ['Fold 1', 'Fold 2', 'Fold 3'] },
        colors: ['#555555', '#888888', ACCENT_COLOR]
    };

    // ==========================================
    // ИНИЦИАЛИЗАЦИЯ ПОСЛЕ ЗАГРУЗКИ DOM
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
         if(document.querySelector("#chart-avg-check")) {
            chartAvgCheck = new ApexCharts(document.querySelector("#chart-avg-check"), optionsAvgCheck);
            chartAvgCheck.render();
        }
        // 1. Создаем экземпляры графиков
        if(document.querySelector("#chart-bar-settlements")) {
        chartSettlements = new ApexCharts(document.querySelector("#chart-bar-settlements"), optionsBarSettlements);
        chartSettlements.render();
    }

        // 2. Создаем МИНИ график (Слайд 5) - используем те же настройки optionsBarSettlements
        if(document.querySelector("#chart-mini-revenue")) {
            // Клонируем настройки, чтобы отключить анимацию при инициализации (опционально) или меняем шрифты
            // Но для простоты используем те же настройки
            chartMiniRevenue = new ApexCharts(document.querySelector("#chart-mini-revenue"), optionsBarSettlements);
            chartMiniRevenue.render();
        }
        if(document.querySelector("#chart-heatmap")) {
            chartHeatmap = new ApexCharts(document.querySelector("#chart-heatmap"), optionsHeatmap);
            chartHeatmap.render();
        }
        if(document.querySelector("#chart-model-perf")) {
            chartModel = new ApexCharts(document.querySelector("#chart-model-perf"), optionsModelPerf);
            chartModel.render();
        }
        if(document.querySelector("#chart-robustness")) {
            chartRobustness = new ApexCharts(document.querySelector("#chart-robustness"), optionsRobustness);
            chartRobustness.render();
        }

        // 2. Загружаем CSV (HISTPLOT.CSV)
        // ВАЖНО: Работает только через Live Server!
        if (typeof Papa !== 'undefined') {
        Papa.parse("histplot.csv", {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                console.log("CSV Loaded");
                const revenueData = results.data.map(row => row['выручка']); 
                const histData = createHistogramData(revenueData);
                
                // Обновляем график на 7 слайде
                if(chartSettlements) {
                    chartSettlements.updateOptions({
                        xaxis: { categories: histData.categories },
                        series: [{ name: 'Магазинов', data: histData.data }]
                    });
                }
                
                // Обновляем график на 5 слайде (ТО ЖЕ САМОЕ)
                if(chartMiniRevenue) {
                chartMiniRevenue.updateOptions({
                    xaxis: { 
                        categories: histData.categories, 
                        // 1. ВКЛЮЧАЕМ ПОДПИСИ
                        labels: { 
                            show: true,
                            rotate: -45,
                            style: { colors: '#888', fontSize: '10px' }
                        } 
                    }, 
                    yaxis: { show: false }, // Ось Y обычно скрывают на мини-графиках, но можно включить true
                    
                    // 2. ВАЖНО: Добавляем отступ снизу (bottom: 25), иначе подписи обрежутся
                    grid: { padding: { left: 10, right: 10, bottom: 25 } },
                    
                    series: [{ name: 'Магазинов', data: histData.data }]
                });
            }
            },
            error: function(err) { console.warn("CSV Error:", err); }
        });
    }

        // 4. ЗАПУСК СЛАЙДЕРА (Только после того как DOM готов)
        totalSlidesEl.innerText = slides.length;
        showSlide(currentSlide);
    });

    // ==========================================
    // ЛОГИКА СЛАЙДЕРА
    // ==========================================
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const totalSlidesEl = document.getElementById('totalSlide');
    const currSlideEl = document.getElementById('currSlide');
    const slideCounter = document.querySelector('.slide-counter');

    function updateCounter() {
        let num = currentSlide + 1;
        currSlideEl.innerText = num < 10 ? '0' + num : num;
    }

    function showSlide(index) {
        if (index === 0) slideCounter.style.display = 'none';
        else slideCounter.style.display = '';

        slides.forEach((slide, i) => {
            slide.classList.remove('active');
            if (i === index) {
                slide.classList.add('active');
                slide.scrollTop = 0;
            }
        });
        updateCounter();
        triggerChartAnimations(index);
    }

    function triggerChartAnimations(index) {
        const slidesArr = Array.from(document.querySelectorAll('.slide'));
        const currentSlideEl = slidesArr[index];
        
        // Добавлена проверка if (chart...), чтобы не падала ошибка
        if (currentSlideEl.id === 'chartSlide1' && chartSettlements) {
            chartSettlements.updateOptions({ chart: { animations: { enabled: true } } });
        }
        if (currentSlideEl.id === 'chartSlide2' && chartHeatmap) {
            chartHeatmap.updateOptions({ chart: { animations: { enabled: true } } });
        }
        if (currentSlideEl.id === 'chartSlide3' && chartModel) {
            chartModel.updateOptions({ chart: { animations: { enabled: true } } });
        }
        if (currentSlideEl.id === 'chartSlide4' && chartRobustness) {
            chartRobustness.updateOptions({ chart: { animations: { enabled: true } } });
        }
        if (currentSlideEl.id === 'chartSlide1') {
            if (chartSettlements) chartSettlements.updateOptions({ chart: { animations: { enabled: true } } });
            if (chartAvgCheck) chartAvgCheck.updateOptions({ chart: { animations: { enabled: true } } });
        }
    }

    function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
    }

    function prevSlide() {
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        showSlide(currentSlide);
    }

    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight' || e.key === 'Space') nextSlide();
        if (e.key === 'ArrowLeft') prevSlide();
    });

    // Пасхалка с фото
    const teamPhotos = document.querySelectorAll('.team-photo-box');
    const explosionOverlay = document.getElementById('resurrection-explosion');
    if (teamPhotos.length > 0 && explosionOverlay) {
        teamPhotos.forEach(photo => {
            photo.addEventListener('mouseenter', () => {
                if (photo.id === 'offlane-photo') return;
                if (!photo.classList.contains('dead') && !photo.classList.contains('resurrected')) {
                    photo.classList.add('dead');
                } else if (photo.classList.contains('dead')) {
                    triggerResurrection(photo);
                }
            });
        });
    }

    function triggerResurrection(element) {
        explosionOverlay.classList.add('explode-anim');
        setTimeout(() => {
            element.classList.remove('dead');
            element.classList.add('resurrected');
        }, 400);
        setTimeout(() => {
            explosionOverlay.classList.remove('explode-anim');
        }, 800);
    }
</script>
